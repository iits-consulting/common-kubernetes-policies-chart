{{ with .Values.policies.disallowUnsignedImages }}
{{ if (and .enabled .test.signedImage) }}

apiVersion: v1
kind: Pod
metadata:
  name: "allow-signed-image"
  annotations:
    "helm.sh/hook": test
    helm.sh/hook-delete-policy: hook-succeeded
spec:
  containers:
    - name: signed-image
      image: "{{ .test.signedImage }}"
  restartPolicy: Never

{{ end }}
{{ end }}